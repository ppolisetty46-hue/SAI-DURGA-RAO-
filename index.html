<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Class Test Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
}
.screen{display:none;padding:20px}
.active{display:block;animation:slide .6s ease}
@keyframes slide{from{transform:translateY(40px);opacity:0} to{transform:translateY(0);opacity:1}}
.card{
  background:white;
  max-width:650px;
  margin:auto;
  padding:20px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.3);
  animation:float 3s infinite ease-in-out;
}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
h2{text-align:center}
input,button{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:1px solid #ccc;font-size:16px;}
button{background:#667eea;color:white;border:none;cursor:pointer;transition:.3s}
button:hover{animation:wobble .6s}
@keyframes wobble{0%{transform:rotate(0)}25%{transform:rotate(2deg)}50%{transform:rotate(-2deg)}75%{transform:rotate(1deg)}100%{transform:rotate(0)}}

.student{background:#f1f1f1;padding:12px;margin-top:12px;border-radius:10px;}
img{max-width:90px;border-radius:8px;}

.bar{background:#ddd;border-radius:20px;overflow:hidden;margin-top:6px;}
.fill{height:18px;width:0;background:#667eea;animation:grow 1.2s forwards;}
@keyframes grow{to{width:var(--w)}}
.logo{max-width:100px;margin:auto;display:block;}
</style>
</head>

<body>

<!-- HOME -->
<div class="screen active" id="home">
<div class="card">
<img id="schoolLogo" class="logo" src="https://via.placeholder.com/100">
<h2 id="schoolName">ğŸ« My School</h2>
<button onclick="openScreen('settings')">âš™ï¸ School Settings</button>
<button onclick="openScreen('add')">â• Add Student Result</button>
<button onclick="openScreen('view')">ğŸ“‹ View Students</button>
<button onclick="openScreen('analysis')">ğŸ“Š Subject Analysis</button>
<button onclick="openScreen('toplow')">ğŸ¯ Top & Lowest</button>
</div>
</div>

<!-- SCHOOL SETTINGS -->
<div class="screen" id="settings">
<div class="card">
<h2>School Settings</h2>
<input id="schoolNameInput" placeholder="School Name">
<button onclick="saveSchool()">Save</button>
<button onclick="openScreen('home')">Back</button>
</div>
</div>

<!-- ADD STUDENT -->
<div class="screen" id="add">
<div class="card">
<h2>ğŸ“ Add Student</h2>
<input id="name" placeholder="Student Name">
<input id="cls" placeholder="Class / Section">
<input id="roll" placeholder="Roll No">
<input id="parent" placeholder="Parent Name">
<input id="photoURL" placeholder="Photo URL (optional)">
<input type="number" id="s1" placeholder="Subject 1 Marks">
<input type="number" id="s2" placeholder="Subject 2 Marks">
<input type="number" id="s3" placeholder="Subject 3 Marks">
<input type="number" id="s4" placeholder="Subject 4 Marks">
<input type="number" id="s5" placeholder="Subject 5 Marks">
<button onclick="saveStudent()">ğŸ’¾ Save</button>
<button onclick="openScreen('home')">â¬… Back</button>
</div>
</div>

<!-- VIEW STUDENTS -->
<div class="screen" id="view">
<div class="card">
<h2>ğŸ“‹ Student List</h2>
<div id="list"></div>
<button onclick="openScreen('home')">Back</button>
</div>
</div>

<!-- SUBJECT ANALYSIS -->
<div class="screen" id="analysis">
<div class="card">
<h2>ğŸ“Š Subject Analysis</h2>
<div id="analysisData"></div>
<button onclick="openScreen('home')">Back</button>
</div>
</div>

<!-- TOP & LOWEST -->
<div class="screen" id="toplow">
<div class="card">
<h2>ğŸ¯ Top & Lowest Students</h2>
<div id="toplowData"></div>
<button onclick="openScreen('home')">Back</button>
</div>
</div>

<script>
function openScreen(id){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id==="view") showStudents();
    if(id==="analysis") showAnalysis();
    if(id==="toplow") showTopLow();
}

// SCHOOL SETTINGS
function saveSchool(){
    let name=document.getElementById("schoolNameInput").value.trim();
    if(name) document.getElementById("schoolName").innerText=name;
    alert("School info saved");
}

// SAVE STUDENT
function saveStudent(){
    let name = document.getElementById("name").value.trim();
    let cls = document.getElementById("cls").value.trim();
    let roll = document.getElementById("roll").value.trim();
    let parent = document.getElementById("parent").value.trim();
    let photoURL = document.getElementById("photoURL").value.trim();

    if(!name || !cls || !roll){
        alert("Please fill student details");
        return;
    }

    let marks = [
        Number(document.getElementById("s1").value)||0,
        Number(document.getElementById("s2").value)||0,
        Number(document.getElementById("s3").value)||0,
        Number(document.getElementById("s4").value)||0,
        Number(document.getElementById("s5").value)||0
    ];

    let total = marks.reduce((a,b)=>a+b,0);
    let percent = (total/marks.length).toFixed(2);
    let grade = percent>=90?"A+":percent>=75?"A":percent>=60?"B":percent>=40?"C":"Fail";

    // Use default photo if no URL provided
    let photo = photoURL || "https://via.placeholder.com/90";

    let db = JSON.parse(localStorage.getItem("results")) || [];
    db.push({name,cls,roll,parent,marks,total,percent,grade,photo});
    localStorage.setItem("results", JSON.stringify(db));
    alert("âœ… Student result saved!");

    // Clear inputs
    document.getElementById("name").value="";
    document.getElementById("cls").value="";
    document.getElementById("roll").value="";
    document.getElementById("parent").value="";
    
    document.getElementById("s1").value="";
    document.getElementById("s2").value="";
    document.getElementById("s3").value="";
    document.getElementById("s4").value="";
    document.getElementById("s5").value="";

    openScreen("home");
}

// VIEW STUDENTS
function showStudents(){
    let db=JSON.parse(localStorage.getItem("results"))||[];
    list.innerHTML=db.map(s=>`
        <div class="student">
        <img src="${s.photo}"><br>
        <b>${s.name}</b> (Roll ${s.roll})<br>
        Class: ${s.cls}<br>
        Parent: ${s.parent}<br>
        Marks: ${s.marks.join(", ")}<br>
        Total: ${s.total} | Grade: ${s.grade}<br>
        <button onclick='generatePDF(${JSON.stringify(s)})'>ğŸ“„ PDF</button>
        </div>`).join("");
}

// GENERATE PDF
function generatePDF(student){
    const { jsPDF } = window.jspdf;
    let pdf=new jsPDF();
    pdf.setFontSize(16);
    pdf.text(document.getElementById("schoolName").innerText,20,20);
    pdf.addImage(student.photo,'JPEG',150,10,40,40);
    pdf.text(`Name: ${student.name}`,20,40);
    pdf.text(`Class: ${student.cls}`,20,50);
    pdf.text(`Roll: ${student.roll}`,20,60);
    pdf.text(`Parent: ${student.parent}`,20,70);
    pdf.text(`Marks: ${student.marks.join(", ")}`,20,80);
    pdf.text(`Total: ${student.total}`,20,90);
    pdf.text(`Percentage: ${student.percent}%`,20,100);
    pdf.text(`Grade: ${student.grade}`,20,110);
    pdf.save(`${student.name}_Report.pdf`);
}

// SUBJECT ANALYSIS
function showAnalysis(){
    let db=JSON.parse(localStorage.getItem("results"))||[];
    if(!db.length){analysisData.innerHTML="No data"; return;}
    let totals=[0,0,0,0,0];
    db.forEach(s=>s.marks.forEach((m,i)=>totals[i]+=m));
    let avg=totals.map(t=>(t/db.length).toFixed(1));
    analysisData.innerHTML=avg.map((a,i)=>`
        <b>Subject ${i+1} (Avg: ${a})</b>
        <div class="bar">
            <div class="fill" style="--w:${a}%"></div>
        </div>
    `).join("");
}

// TOP & LOWEST
function showTopLow(){
    let db=JSON.parse(localStorage.getItem("results"))||[];
    if(!db.length){toplowData.innerHTML="No data"; return;}
    db.sort((a,b)=>b.total-a.total);
    let top=db[0], low=db[db.length-1];
    toplowData.innerHTML=`
        <b>Topper:</b> ${top.name} | Total: ${top.total} | Percentage: ${top.percent}%<br>
        <b>Lowest:</b> ${low.name} | Total: ${low.total} | Percentage: ${low.percent}%`;
}
</script>

</body>
</html>
